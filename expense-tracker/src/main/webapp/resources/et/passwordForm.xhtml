<?xml version='1.0' encoding='UTF-8' ?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://java.sun.com/jsf/composite"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    
    <!--
        This composite component is admittedly a hack, as it contains hardwired 
        bindings. It is used just to avoid some boilerplate.
    
        It is bound to EmployeeController.PasswordHolder and outputs a password
        change form. 
    
        The form can be used while creating a new user, with inline=true, which
        omits the <h:form> and the "Change password" button; or when editing
        an existing user, with inline=false.
    -->
    <cc:interface>
        <cc:attribute name="inline" default="false" type="java.lang.Boolean" />
    </cc:interface>

    <cc:implementation>
        <c:choose>
            <c:when test="#{not cc.attrs.inline}">
                <h:form id="#{cc.id}">
                    <rich:messages for="#{cc.id}_passwordValidator" />
                    <rich:graphValidator value="#{passwordHolder}" id="#{cc.id}_passwordValidator">
                        <h:panelGrid id="#{cc.id}_passwordPanelGrid" columns="3" border="0">
                            <h:outputLabel value="Password:" for="#{cc.id}_password"/>
                            <h:inputSecret value="#{passwordHolder.password}" label="Password" id="#{cc.id}_password">
                                <f:validateRequired />
                            </h:inputSecret>
                            <rich:message for="#{cc.id}_password" />

                            <h:outputLabel value="Password confirmation:" for="#{cc.id}_passwordConfirmation"/>
                            <h:inputSecret value="#{passwordHolder.passwordConfirmation}" label="Password Confirmation" id="#{cc.id}_passwordConfirmation" />
                            <rich:message for="#{cc.id}_passwordConfirmation" />
                            <f:facet name="footer">
                                <h:commandButton action="#{passwordHolder.changePassword(employeeController.selected, passwordHolder.password)}" value="Change password" />
                            </f:facet>
                        </h:panelGrid>
                    </rich:graphValidator>
                </h:form>
            </c:when>
            <c:otherwise>
                <rich:messages for="#{cc.id}_passwordValidator" />
                <rich:graphValidator value="#{passwordHolder}" id="#{cc.id}_passwordValidator">
                    <h:panelGrid id="#{cc.id}_passwordPanelGrid" columns="3" border="0">
                        <h:outputLabel value="Password:" for="#{cc.id}_password"/>
                        <h:inputSecret value="#{passwordHolder.password}" label="Password" id="#{cc.id}_password">
                            <f:validateRequired />
                        </h:inputSecret>
                        <rich:message for="#{cc.id}_password" />

                        <h:outputLabel value="Password confirmation:" for="#{cc.id}_passwordConfirmation"/>
                        <h:inputSecret value="#{passwordHolder.passwordConfirmation}" label="Password Confirmation" id="#{cc.id}_passwordConfirmation" />
                        <rich:message for="#{cc.id}_passwordConfirmation" />
                    </h:panelGrid>
                </rich:graphValidator>
            </c:otherwise>
        </c:choose>

    </cc:implementation>
</html>